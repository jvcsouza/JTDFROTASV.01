/*CREATE DATABASE JTDFROTAS;*/

USE JTDFROTAS;

CREATE TABLE UF (
	ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
	NOME VARCHAR(30) NOT NULL,
	UF VARCHAR(2) NOT NULL,
	ATIVO BIT DEFAULT 1
);
CREATE TABLE CIDADE(
	ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
	CODUF INT FOREIGN KEY REFERENCES UF(ID) NOT NULL,
	NOME VARCHAR(30) NOT NULL,
	ATIVO BIT DEFAULT 1
);
CREATE TABLE PESSOA(
    ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    NOME VARCHAR(100) NOT NULL,
	CODCIDADE INT FOREIGN KEY REFERENCES CIDADE(ID) NOT NULL,
    LOGRADOURO VARCHAR(100),
    NUM VARCHAR(5),
    ATIVO TINYINT DEFAULT 1 NOT NULL
);
CREATE TABLE USUARIO(
    ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    NOME VARCHAR(10) NOT NULL,
    SENHA VARCHAR(10) NOT NULL
);
CREATE TABLE TELA(
	ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
	NOME VARCHAR(50) NOT NULL
);
CREATE TABLE USUARIOPERMS(
	ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
	CODUSUARIO INT FOREIGN KEY REFERENCES USUARIO(ID) NOT NULL,
	CODTELA INT FOREIGN KEY REFERENCES TELA(ID) NOT NULL,
	LEITURA TINYINT DEFAULT 1,
	GRAVACAO TINYINT DEFAULT 1,
	EXCLUSAO TINYINT DEFAULT 1,
	ALTERACAO TINYINT DEFAULT 1
);
CREATE TABLE FISICA(
    ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    CODPESSOA INT FOREIGN KEY REFERENCES PESSOA(ID) NOT NULL,
    CPF VARCHAR(12) NOT NULL
);
CREATE TABLE JURIDICA(
    ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    CODPESSOA INT FOREIGN KEY REFERENCES PESSOA(ID) NOT NULL,
    CNPJ VARCHAR(14) NOT NULL,
    ATIVIDADE TEXT,
    FANTASIA VARCHAR(50)
);
CREATE TABLE TELEFONE(
    ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    CODPESSOA INT FOREIGN KEY REFERENCES PESSOA(ID) NOT NULL,
    CONTATO VARCHAR(20),
    TELEFONE VARCHAR(10) NOT NULL
);
CREATE TABLE TIPOCARTA(
    ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    TIPO VARCHAR(15) NOT NULL,
	DESCRICAO TEXT
);
CREATE TABLE TIPOVEICULO(
    ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    NOME VARCHAR(15) NOT NULL,
	CODTIPOCARTA INT FOREIGN KEY REFERENCES TIPOCARTA(ID) NOT NULL,
    ATIVO TINYINT DEFAULT 1 NOT NULL
);
CREATE TABLE MARCAVEICULO(
	ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
	NOME VARCHAR(30) NOT NULL,
	ATIVO BIT DEFAULT 1
);
CREATE TABLE MODELOVEICULO(
	ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
	CODMARCAVEICULO INT FOREIGN KEY REFERENCES MARCAVEICULO(ID) NOT NULL,
	NOME VARCHAR(50) NOT NULL,
	ATIVO BIT DEFAULT 1
);
CREATE TABLE VEICULO(
    ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    CODCLIENTE INT FOREIGN KEY REFERENCES PESSOA(ID),
	CODMODELOVEICULO INT FOREIGN KEY REFERENCES MODELOVEICULO(ID) NOT NULL,
    TIPOVEICULO INT FOREIGN KEY REFERENCES TIPOVEICULO(ID) NOT NULL,
    PLACA VARCHAR(7) NOT NULL,
	ULTIMAMANUTENCAO DATE,
    DATARESGISTRO DATE NOT NULL,
	EMMANUTENCAO BIT,
	DATAFINALMANUTENCAO DATE,
    ULTIMAALTERA DATE,
    DISPONIVEL TINYINT DEFAULT 1 NOT NULL
);
CREATE TABLE MOTORISTA(
    ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    CODPESSOA INT FOREIGN KEY REFERENCES PESSOA(ID),
    CODTIPOCARTA INT FOREIGN KEY REFERENCES TIPOCARTA(ID)
);
CREATE TABLE VIAGEM(
    ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    CODCLIENTE INT FOREIGN KEY REFERENCES PESSOA(ID) NOT NULL,
    DESTINO INT FOREIGN KEY REFERENCES CIDADE(ID) NOT NULL,
    SAIDA INT FOREIGN KEY REFERENCES CIDADE(ID) NOT NULL,
	KMTOTAL DECIMAL(4,2) CHECK(KMTOTAL >= 0),
    DATARESGISTRO DATE NOT NULL,
    ULTIMAALTERA DATE NOT NULL,
    CODUSUARIO INT FOREIGN KEY REFERENCES USUARIO(ID) NOT NULL,
);
CREATE TABLE FROTA(
    ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
    CODVEICULO INT FOREIGN KEY REFERENCES VEICULO(ID) NOT NULL,
    CODMOTO INT FOREIGN KEY REFERENCES MOTORISTA(ID) NOT NULL,
    CODVIAGEM INT FOREIGN KEY REFERENCES VIAGEM(ID) NOT NULL
);
CREATE TABLE PECA(
	ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
	NOME VARCHAR(30) NOT NULL,
	ESTOQUE INT DEFAULT 0 NOT NULL CHECK(ESTOQUE >= 0),
	PRECO DECIMAL(4,2) NOT NULL CHECK(PRECO >= 0)
);
CREATE TABLE TIPOMANUTENCAO(
	ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
	NOME VARCHAR(30) NOT NULL
)
CREATE TABLE MANUTENCAO(
	ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
	CODTIPOMANUTENCAO INT FOREIGN KEY REFERENCES TIPOMANUTENCAO(ID) NOT NULL,
	PRECOTOTAL DECIMAL(4,2) DEFAULT 0 CHECK(PRECOTOTAL >= 0),
	CODUSUARIO INT FOREIGN KEY REFERENCES USUARIO(ID)
)
CREATE TABLE PECAMANUTENCAO(
	ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
	CODPECA INT FOREIGN KEY REFERENCES PECA(ID) NOT NULL, 
	CODMANUTENCAO INT FOREIGN KEY REFERENCES MANUTENCAO(ID) NOT NULL,
	QTD INT DEFAULT 1 NOT NULL CHECK(QTD > 0),
	PRECO DECIMAL(4,2) NOT NULL CHECK(PRECO >= 0)
);
CREATE TABLE FINANCA(
	ID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
	CODVIAGEM INT FOREIGN KEY REFERENCES VIAGEM(ID),
	CODMANUTENCAO INT FOREIGN KEY REFERENCES MANUTENCAO(ID),
	DATAREGISTRO DATE NOT NULL,
	QUITADO TINYINT NOT NULL DEFAULT 0,
	VALORTOTAL DECIMAL(4,2) CHECK(VALORTOTAL >= 0),
	DEVEDOR INT FOREIGN KEY REFERENCES PESSOA(ID) NOT NULL
);